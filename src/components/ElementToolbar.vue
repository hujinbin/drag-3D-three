<!-- src/components/ElementToolbar.vue -->
<template>
  <div class="bg-gray-100 p-4 shadow-lg h-full flex flex-col overflow-y-auto">
    <h3 class="text-lg font-semibold mb-4">元素库</h3>
    
    <!-- 基础形状分类 -->
    <div class="mb-6">
      <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
        </svg>
        基础形状
      </h4>
      <div class="grid grid-cols-2 gap-2">
        <DraggableElement 
          v-for="elementType in basicShapes" 
          :key="elementType" 
          :type="elementType"
        />
      </div>
    </div>
    
    <!-- 预设模型分类 -->
    <div class="mb-6">
      <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.504 1.132a1 1 0 01.992 0l1.75 1a1 1 0 11-.992 1.736L10 3.152l-1.254.716a1 1 0 11-.992-1.736l1.75-1zM5.618 4.504a1 1 0 01-.372 1.364L5.016 6l.23.132a1 1 0 11-.992 1.736L4 7.723V8a1 1 0 01-2 0V6a.996.996 0 01.52-.878l1.734-.99a1 1 0 011.364.372zm8.764 0a1 1 0 011.364-.372l1.733.99A1.002 1.002 0 0118 6v2a1 1 0 11-2 0v-.277l-.254.145a1 1 0 11-.992-1.736l.23-.132-.23-.132a1 1 0 01-.372-1.364zm-7 4a1 1 0 011.364-.372L10 8.848l1.254-.716a1 1 0 11.992 1.736L11 10.58V12a1 1 0 11-2 0v-1.42l-1.246-.712a1 1 0 01-.372-1.364zM3 11a1 1 0 011 1v1.42l1.246.712a1 1 0 11-.992 1.736l-1.75-1A1 1 0 012 14v-2a1 1 0 011-1zm14 0a1 1 0 011 1v2a1 1 0 01-.504.868l-1.75 1a1 1 0 11-.992-1.736L16 13.42V12a1 1 0 011-1zm-9.618 5.504a1 1 0 011.364-.372l.254.145V16a1 1 0 112 0v.277l.254-.145a1 1 0 11.992 1.736l-1.735.992a.995.995 0 01-1.022 0l-1.735-.992a1 1 0 01-.372-1.364z" clip-rule="evenodd" />
        </svg>
        预设模型
      </h4>
      <div class="grid grid-cols-2 gap-2">
        <DraggableElement 
          v-for="model in presetModels" 
          :key="model.id" 
          type="custom"
          :name="model.name"
          :modelUrl="model.url"
        />
      </div>
    </div>
    
    <!-- 用户上传的模型 -->
    <div v-if="userModels.length > 0" class="mb-6">
      <h4 class="text-sm font-medium text-gray-700 mb-2 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z" />
        </svg>
        我的模型
      </h4>
      <div class="grid grid-cols-2 gap-2">
        <DraggableElement 
          v-for="model in userModels" 
          :key="model.id" 
          type="custom"
          :name="model.name"
          :modelUrl="model.url"
        />
      </div>
    </div>
    
    <!-- 上传模型 -->
    <div class="mt-auto pt-4 border-t border-gray-200">
      <label 
        class="flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 cursor-pointer transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
        上传3D模型
        <input 
          type="file" 
          accept=".glb,.gltf,.obj,.fbx,.stl" 
          class="hidden"
          @change="handleFileUpload"
        >
      </label>
      <p class="text-xs text-gray-500 mt-2 text-center">
        支持 .glb, .gltf, .obj, .fbx, .stl 格式
      </p>
    </div>
  </div>
</template>

<script lang="ts" setup>
import { ref } from 'vue'
import DraggableElement from './DraggableElement.vue'

// 定义元素类型
type ElementType = 'cube' | 'sphere' | 'cylinder' | 'pyramid'

// 基础形状
const basicShapes: ElementType[] = ['cube', 'sphere', 'cylinder', 'pyramid']

// 预设模型
const presetModels = ref([
  { id: 'table', name: '桌子', url: '/models/table.glb' },
  { id: 'chair', name: '椅子', url: '/models/chair.glb' },
  { id: 'lamp', name: '台灯', url: '/models/lamp.glb' },
  { id: 'plant', name: '植物', url: '/models/plant.glb' }
])

// 用户上传的模型
const userModels = ref<Array<{id: string, name: string, url: string}>>([])

// 处理文件上传
const handleFileUpload = (event: Event) => {
  const input = event.target as HTMLInputElement
  if (!input.files || input.files.length === 0) return
  
  const file = input.files[0]
  const fileName = file.name.split('.')[0]
  
  // 创建文件的URL
  const fileUrl = URL.createObjectURL(file)
  
  // 添加到用户模型列表
  userModels.value.push({
    id: `user-model-${Date.now()}`,
    name: fileName,
    url: fileUrl
  })
  
  // 重置输入框，允许再次上传相同文件
  input.value = ''
}
</script>